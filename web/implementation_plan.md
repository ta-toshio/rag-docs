# ファイル一覧表示機能 実装計画

## 概要

`initialTask.md` に記載されているタスクのうち、ファイル一覧を取得する API の実装 (タスク 4) から、ファイルリストをツリー表示用にデータ整形 (タスク 5) までを実装する計画です。

## 詳細計画

1.  **API のエンドポイントの確認:**
    *   `app/api/files/route.ts` がファイル一覧を取得するAPIのエンドポイントであることを確認します。
    *   必要に応じて、プロジェクトIDを受け取るように修正します。今回のタスクではプロジェクトIDは不要のようなので、修正は行いません。
2.  **フロントエンドでのAPI呼び出し:**
    *   `useEffect` を使用して、API (`/api/files`) を呼び出し、ファイル一覧を取得します。
    *   取得したデータを `TreeView` コンポーネントに渡します。
3.  **`TreeView` コンポーネントの修正:**
    *   `components/tree-view.tsx` を修正し、APIから取得したデータを受け取ってツリー表示するようにします。
    *   フォルダの開閉機能を実装します。
4.  **データ整形処理の確認:**
    *   `app/api/files/route.ts` でファイルリストをツリー表示用にデータ整形する処理 (`buildFileTree` 関数) が実装されていることを確認します。
    *   必要に応じて、フロントエンドでデータ整形処理を行うことも検討します。今回はAPI側でデータ整形処理を行うことにします。
5.  **フォルダの開閉状態の記憶:**
    *   開いたフォルダの状態をローカルストレージに保存し、次回アクセス時に復元するようにします。

## Mermaid ダイアグラム

```mermaid
graph LR
    A[フロントエンド (App/page.tsx)] --> B(API呼び出し (/api/files));
    B --> C{ファイル一覧データ取得 (app/api/files/route.ts)};
    C --> D[ファイルツリーデータ (JSON)];
    D --> E(TreeViewコンポーネント (components/tree-view.tsx));
    E --> F[ファイルツリー表示];
    G[ローカルストレージ] -- フォルダ開閉状態保存 --> E;
    style C fill:#f9f,stroke:#333,stroke-width:2px
    style E fill:#ccf,stroke:#333,stroke-width:2px